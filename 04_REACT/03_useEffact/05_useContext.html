<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>useContext ì˜ˆì œ</title>
    <script
      src="https://unpkg.com/react@18/umd/react.development.js"
      crossorigin
    ></script>
    <script
      src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"
      crossorigin
    ></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  </head>
  <body>
    <div id="root"></div>

    <script type="text/babel">
      const { useState, useEffect, useRef, createContext, useContext } = React;

      // 1ï¸âƒ£ Context ìƒì„±
      const UserContext = createContext();

      // 2ï¸âƒ£ ë¡œê·¸ì¸ ì»´í¬ë„ŒíŠ¸
      function LoginComponent() {
        const [form, setForm] = useState({ username: '', password: '' });
        const usernameRef = useRef();

        // ì „ì—­ context ì ‘ê·¼ (UserContext ì•ˆì˜ setter ê°€ì ¸ì˜´)
        const { setUser } = useContext(UserContext);

        useEffect(() => {
          usernameRef.current.focus();
        }, []);

        const onChangeHandler = (e) => {
          setForm({ ...form, [e.target.name]: e.target.value });
        };

        const onClickHandler = () => {
          if (!form.username) {
            alert('ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”!');
            return;
          }
          // ë¡œê·¸ì¸í•œ ìœ ì € ì´ë¦„ì„ contextì— ì €ì¥
          setUser(form.username);
          alert(`${form.username}ë‹˜ í™˜ì˜í•©ë‹ˆë‹¤!`);
          setForm({ username: '', password: '' });
          usernameRef.current.focus();
        };

        return (
          <>
            <input
              type="text"
              name="username"
              placeholder="ì´ë¦„"
              onChange={onChangeHandler}
              value={form.username}
              ref={usernameRef}
            />
            <br />
            <input
              type="password"
              name="password"
              placeholder="ë¹„ë°€ë²ˆí˜¸"
              onChange={onChangeHandler}
              value={form.password}
            />
            <br />
            <button onClick={onClickHandler}>ë¡œê·¸ì¸</button>
          </>
        );
      }

      // 3ï¸âƒ£ ìƒë‹¨ ê³µí†µ í—¤ë” (ë¡œê·¸ì¸ ì‚¬ìš©ì í‘œì‹œ)
      function Header() {
        const { user } = useContext(UserContext);
        return (
          <div
            style={{
              backgroundColor: '#333',
              color: 'white',
              padding: '10px',
              marginBottom: '10px',
            }}
          >
            <h2>ğŸ¬ ì˜í™”ë¦¬ë·°ì‚¬ì´íŠ¸</h2>
            {user ? <p>ì•ˆë…•í•˜ì„¸ìš”, {user}ë‹˜ ğŸ‘‹</p> : <p>ë¡œê·¸ì¸ í•´ì£¼ì„¸ìš”.</p>}
          </div>
        );
      }

      // 4ï¸âƒ£ ë©”ì¸ App
      function App() {
        const [user, setUser] = useState(null);

        return (
          // Providerë¡œ user ìƒíƒœë¥¼ ì „ì—­ ê³µê¸‰
          <UserContext.Provider value={{ user, setUser }}>
            <Header />
            <LoginComponent />
          </UserContext.Provider>
        );
      }

      ReactDOM.createRoot(document.getElementById('root')).render(<App />);
    </script>
  </body>
</html>
